// Generated by CoffeeScript 2.0.0-beta7
void function () {
  var async, buildTasks, findAll, getPaths, Path, utils;
  Path = require('path');
  utils = require('./utils');
  async = require('async');
  module.exports = function (paths, options, callback) {
    var iterator;
    if ('function' === typeof options) {
      callback = options;
      options = {};
    }
    if (utils.isString(paths))
      return getPaths(paths, options, callback);
    iterator = function (accum, path, cb) {
      return getPaths(path, options, function (err, paths) {
        if (null != err)
          return cb(err);
        return cb(null, accum.concat(paths));
      });
    };
    async.reduce(paths, [], iterator, callback);
  };
  getPaths = function (path, options, cb) {
    findAll(path, options, function (err, paths) {
      var tasks;
      if (null != err)
        return cb(err);
      tasks = buildTasks(paths, options);
      if (!tasks.length) {
        return cb(null, paths);
      } else {
        return async.waterfall(tasks, function (err, paths) {
          if (null != err) {
            return cb(err);
          } else {
            return cb(null, paths);
          }
        });
      }
    });
  };
  findAll = function (path, options, cb) {
    if (options.absolute === true)
      path = Path.resolve(path);
    return utils.isFile(path, function (pathIsFile) {
      var pattern;
      if (pathIsFile) {
        return cb(null, [path]);
      } else {
        pattern = utils.getGlobPattern(path, options);
        return utils.glob(pattern, options, cb);
      }
    });
  };
  buildTasks = function (paths, options) {
    var excludedPaths, removeDirectories, tasks;
    tasks = [];
    if (null != (excludedPaths = options.exclude))
      tasks.push(function (cb) {
        return cb(null, utils.rejectPaths(paths, excludedPaths));
      });
    if (options.includeDirectories === false) {
      removeDirectories = function (paths, cb) {
        return async.filter(paths, utils.isFile, function (files) {
          return cb(null, files);
        });
      };
      if (!tasks.length)
        removeDirectories = removeDirectories.bind(null, paths);
      tasks.push(removeDirectories);
    }
    return tasks;
  };
}.call(this);
